
> [!NOTE]
> Documentation auto-generated by [ai-docs.](https://github.com/connor-john/ai-docs)

Here's a comprehensive documentation for the `pytest_plugins = ["pytester"]` module:

# Pytester Plugin Documentation

## Module Overview
The `pytester` plugin is a built-in pytest plugin that provides utilities for testing pytest plugins and fixtures. It enables creating temporary test directories, running pytest in subprocess mode, and analyzing test outcomes programmatically.

- **Core Functionality**: Creates isolated test environments for pytest plugin testing
- **Key Features**: Temporary directory management, subprocess test execution, output parsing
- **Target Use Cases**: Testing pytest plugins, fixtures, and test infrastructure
- **Dependencies**: pytest (core)

## Installation and Setup

### Requirements
```toml
# pyproject.toml
[tool.poetry.dependencies]
python = "^3.8"
pytest = "^7.0.0"
```

### Configuration
```python
# conftest.py
pytest_plugins = ["pytester"]
```

## Usage Guide

### Basic Example
```python
def test_simple_plugin(pytester):
    # Create a temporary test file
    pytester.makepyfile("""
        def test_example():
            assert 1 + 1 == 2
    """)

    # Run pytest
    result = pytester.runpytest()

    # Assert outcomes
    result.assert_outcomes(passed=1)
```

## Testing Guide

### 1. Basic Plugin Testing

```python
# test_plugin.py
from typing import Any
import pytest
from _pytest.pytester import Pytester

def test_basic_functionality(pytester: Pytester) -> None:
    """Test basic plugin functionality.

    Args:
        pytester: Pytest fixture for testing plugins
    """
    # Create test file
    pytester.makepyfile("""
        def test_example():
            assert True
    """)

    # Run pytest
    result = pytester.runpytest()

    # Check results
    result.assert_outcomes(passed=1)
    result.stdout.fnmatch_lines(["*1 passed*"])
```

### 2. Testing Custom Fixtures

```python
# test_fixtures.py
from typing import Any
from _pytest.pytester import Pytester

def test_custom_fixture(pytester: Pytester) -> None:
    """Test custom fixture implementation.

    Args:
        pytester: Pytest fixture for testing plugins
    """
    # Create conftest.py with fixture
    pytester.makeconftest("""
        import pytest

        @pytest.fixture
        def sample_fixture():
            return "test_value"
    """)

    # Create test file using fixture
    pytester.makepyfile("""
        def test_with_fixture(sample_fixture):
            assert sample_fixture == "test_value"
    """)

    # Run pytest
    result = pytester.runpytest()
    result.assert_outcomes(passed=1)
```

### 3. Testing Command Line Options

```python
# test_cli.py
from typing import Any
from _pytest.pytester import Pytester

def test_cli_options(pytester: Pytester) -> None:
    """Test command line option handling.

    Args:
        pytester: Pytest fixture for testing plugins
    """
    pytester.makepyfile("""
        def test_verbose():
            print("Test output")
    """)

    # Run with -v flag
    result = pytester.runpytest("-v")

    # Assert verbose output
    result.stdout.fnmatch_lines(["*test_verbose*PASSED*"])
```

### 4. Testing Error Cases

```python
# test_errors.py
from typing import Any
from _pytest.pytester import Pytester

def test_failure_cases(pytester: Pytester) -> None:
    """Test error handling and failure scenarios.

    Args:
        pytester: Pytest fixture for testing plugins
    """
    pytester.makepyfile("""
        import pytest

        def test_failure():
            raise ValueError("Expected error")

        def test_skip():
            pytest.skip("Skip reason")
    """)

    result = pytester.runpytest()
    result.assert_outcomes(failed=1, skipped=1)
```

## Common Test Fixtures

### Pytester Fixture Methods

```python
def demonstrate_pytester_methods(pytester: Pytester) -> None:
    """Demonstrate common pytester fixture methods.

    Args:
        pytester: Main testing fixture
    """
    # Create directory structure
    pytester.mkdir("tests")

    # Create Python module
    pytester.makepyfile(test_content="""
        def test_example():
            pass
    """)

    # Create conftest
    pytester.makeconftest("""
        import pytest

        @pytest.fixture
        def fixture_example():
            return True
    """)

    # Create ini file
    pytester.makeini("""
        [pytest]
        markers =
            slow: marks tests as slow
    """)
```

## Testing Best Practices

### 1. Test Organization

```python
# test_organization.py
import pytest
from typing import Any
from _pytest.pytester import Pytester

class TestPluginFeatures:
    """Group related plugin tests."""

    @pytest.fixture
    def setup_plugin_test(self, pytester: Pytester) -> None:
        """Setup common test environment.

        Args:
            pytester: Pytest fixture
        """
        pytester.makepyfile("""
            def test_feature():
                assert True
        """)

    def test_feature_one(self, pytester: Pytester, setup_plugin_test: Any) -> None:
        """Test specific feature.

        Args:
            pytester: Pytest fixture
            setup_plugin_test: Setup fixture
        """
        result = pytester.runpytest()
        result.assert_outcomes(passed=1)
```

### 2. Output Validation

```python
def test_output_parsing(pytester: Pytester) -> None:
    """Test output parsing capabilities.

    Args:
        pytester: Pytest fixture
    """
    pytester.makepyfile("""
        def test_output():
            print("Expected output")
    """)

    result = pytester.runpytest()

    # Check stdout
    result.stdout.fnmatch_lines(["*Expected output*"])

    # Check for warnings
    result.stderr.no_fnmatch_line("*warning*")
```

## Error Handling and Debugging

```python
def test_debug_capabilities(pytester: Pytester) -> None:
    """Demonstrate debugging features.

    Args:
        pytester: Pytest fixture
    """
    # Enable verbose output
    result = pytester.runpytest("-vv")

    # Check for specific debug info
    result.stdout.fnmatch_lines(["*collected*items*"])

    # Access raw output
    raw_output = result.stdout.str()
    raw_error = result.stderr.str()
```

## Best Practices Summary

1. Always type-hint pytester fixture
2. Use descriptive test names
3. Group related tests in classes
4. Validate both success and failure cases
5. Check output thoroughly
6. Use proper assertions
7. Document test purposes
8. Handle cleanup properly
9. Maintain test isolation
10. Use appropriate markers

This documentation provides a comprehensive guide for using the pytester plugin in pytest. It covers the main functionality, testing patterns, and best practices for plugin testing.
