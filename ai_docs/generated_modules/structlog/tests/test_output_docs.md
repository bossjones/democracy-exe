
> [!NOTE]
> Documentation auto-generated by [ai-docs.](https://github.com/connor-john/ai-docs)

Here's a comprehensive documentation for the logger module:

# Logger Module Documentation

## Module Overview

This module implements various logger classes for structured logging in Python, featuring string and bytes-based logging capabilities with thread-safe writing operations.

### Key Features
- Multiple logger implementations (PrintLogger, WriteLogger, BytesLogger)
- Thread-safe logging operations
- Support for stdout/stderr and file outputs
- Pickle support for stdout/stderr loggers
- Standard library logger method compatibility
- Factory classes for logger instantiation

### Dependencies
- pytest (for testing)
- structlog (core dependency)
- Python 3.7+

## Installation and Setup

```bash
pip install structlog
```

## Usage Guide

### Basic Usage

```python
from structlog import PrintLogger, WriteLogger, BytesLogger

# Standard string logging to stdout
logger = PrintLogger()
logger.msg("Hello World")  # Prints: Hello World

# Logging to a file
with open("app.log", "w") as f:
    logger = WriteLogger(f)
    logger.msg("Log to file")  # Writes to app.log

# Bytes logging
bytes_logger = BytesLogger()
bytes_logger.msg(b"Hello \xc3\xb6")  # Prints: Hello รถ
```

### Factory Pattern Usage

```python
from structlog import PrintLoggerFactory, WriteLoggerFactory

# Create loggers using factories
print_factory = PrintLoggerFactory()
logger1 = print_factory()
logger2 = print_factory()  # New instance

# Factory with specific output
from sys import stderr
stderr_factory = WriteLoggerFactory(stderr)
error_logger = stderr_factory()
```

## Testing Guide

### Test Setup

```python
# conftest.py
import pytest
from io import StringIO, BytesIO

@pytest.fixture
def sio():
    """String IO fixture for capturing text output."""
    return StringIO()

@pytest.fixture
def bio():
    """Bytes IO fixture for capturing binary output."""
    return BytesIO()
```

### Basic Logger Tests

```python
import pytest
from structlog import PrintLogger

def test_print_logger_stdout(capsys):
    """Test PrintLogger stdout output."""
    logger = PrintLogger()
    logger.msg("test message")

    out, err = capsys.readouterr()
    assert "test message\n" == out
    assert "" == err

def test_print_logger_file(tmp_path):
    """Test PrintLogger file output."""
    log_file = tmp_path / "test.log"

    with log_file.open("w") as f:
        logger = PrintLogger(f)
        logger.msg("test message")

    assert "test message\n" == log_file.read_text()
```

### BytesLogger Tests

```python
import pytest
from structlog import BytesLogger

def test_bytes_logger_encoding(capsys):
    """Test BytesLogger handles encoded bytes."""
    logger = BytesLogger()
    logger.msg(b"hello \xc3\xb6")  # UTF-8 encoded รถ

    out, err = capsys.readouterr()
    assert "hello รถ\n" == out
    assert "" == err

@pytest.mark.parametrize("method", ["debug", "info", "warning", "error", "critical"])
def test_stdlib_compatibility(method, bio):
    """Test standard library logger method compatibility."""
    logger = BytesLogger(bio)
    getattr(logger, method)(b"test")
    assert b"test" in bio.getvalue()
```

### Thread Safety Tests

```python
import threading
import pytest
from structlog import WriteLogger

def test_thread_safety(tmp_path):
    """Test concurrent logging operations."""
    log_file = tmp_path / "threaded.log"

    def write_logs(logger, count):
        for i in range(count):
            logger.msg(f"Message {i}")

    with log_file.open("w") as f:
        logger = WriteLogger(f)
        threads = [
            threading.Thread(target=write_logs, args=(logger, 100))
            for _ in range(5)
        ]

        for t in threads:
            t.start()
        for t in threads:
            t.join()

    log_content = log_file.read_text()
    assert len(log_content.splitlines()) == 500
```

### Pickle Support Tests

```python
import pickle
import pytest
from structlog import PrintLogger
from sys import stdout, stderr

@pytest.mark.parametrize("file", [None, stdout, stderr])
@pytest.mark.parametrize("protocol", range(pickle.HIGHEST_PROTOCOL + 1))
def test_pickle_support(file, protocol):
    """Test logger pickle support for stdout/stderr."""
    logger = PrintLogger(file=file)
    pickled = pickle.dumps(logger, protocol)
    unpickled = pickle.loads(pickled)

    assert logger._file is unpickled._file
    assert logger._lock is unpickled._lock
```

## Error Handling and Edge Cases

```python
def test_invalid_file_handling():
    """Test logger behavior with invalid file objects."""
    with pytest.raises(AttributeError):
        PrintLogger(123)  # Not a file-like object

def test_closed_file_handling(tmp_path):
    """Test logging to closed file."""
    log_file = tmp_path / "closed.log"
    f = log_file.open("w")
    logger = WriteLogger(f)
    f.close()

    with pytest.raises(ValueError):
        logger.msg("test")
```

## Performance Testing

```python
import time
import pytest

def test_logger_performance(tmp_path):
    """Test logging performance."""
    log_file = tmp_path / "perf.log"

    with log_file.open("w") as f:
        logger = WriteLogger(f)
        start_time = time.time()

        for i in range(10000):
            logger.msg(f"Performance test message {i}")

        duration = time.time() - start_time
        assert duration < 1.0  # Should complete within 1 second
```

## Debugging and Troubleshooting

Common issues and solutions:

1. File permission errors:
   - Ensure write permissions for log files
   - Use try/except for file operations

2. Thread safety issues:
   - Always use the logger's built-in locks
   - Avoid sharing file handles between loggers

3. Memory usage:
   - Close file handles when done
   - Use context managers for file operations

4. Encoding issues:
   - Use BytesLogger for binary data
   - Ensure correct file opening modes (text vs binary)

Remember to:
- Always close file handles
- Use appropriate logger types for your data
- Handle exceptions properly
- Test with various Python versions
- Consider thread safety in concurrent applications
