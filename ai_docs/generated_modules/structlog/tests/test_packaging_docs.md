
> [!NOTE]
> Documentation auto-generated by [ai-docs.](https://github.com/connor-john/ai-docs)

Here's comprehensive documentation for the legacy metadata testing module:

# Legacy Metadata Test Module Documentation

## Module Overview

This module tests the legacy metadata attributes of the structlog package. It verifies that deprecated metadata attributes are still accessible while ensuring proper deprecation warnings are raised.

**Key Features:**
- Tests version metadata accessibility
- Verifies deprecated metadata attributes
- Ensures proper deprecation warnings
- Validates error handling for non-existent attributes

**Dependencies:**
- pytest
- structlog
- importlib.metadata

## Installation and Setup

```bash
pip install pytest structlog
```

Required versions:
```
pytest>=7.0.0
structlog>=21.0.0
```

## Usage Guide

The module contains a test class `TestLegacyMetadataHack` that verifies structlog's metadata handling:

```python
import pytest
from importlib import metadata
import structlog

# Access version (not deprecated)
version = structlog.__version__

# Access deprecated metadata
description = structlog.__description__  # Will raise deprecation warning
uri = structlog.__uri__  # Will raise deprecation warning
email = structlog.__email__  # Will raise deprecation warning
```

## Testing Guide

### 1. Version Test

Tests that `structlog.__version__` returns the correct version without warnings.

```python
def test_version(self, recwarn):
    """
    Test version metadata access.

    Args:
        recwarn: pytest warning recorder fixture
    """
    assert metadata.version("structlog") == structlog.__version__
    assert [] == recwarn.list
```

### 2. Description Test

Verifies the deprecated description attribute.

```python
def test_description(self):
    """Test description metadata access with deprecation warning."""
    with pytest.deprecated_call():
        assert "Structured Logging for Python" == structlog.__description__
```

### 3. URI Test

Checks the deprecated URI attribute.

```python
def test_uri(self):
    """Test URI metadata access with deprecation warning."""
    with pytest.deprecated_call():
        assert "https://www.structlog.org/" == structlog.__uri__
```

### 4. Email Test

Validates the deprecated email attribute.

```python
def test_email(self):
    """Test email metadata access with deprecation warning."""
    with pytest.deprecated_call():
        assert "hs@ox.cx" == structlog.__email__
```

### 5. Non-existent Attribute Test

Tests error handling for undefined attributes.

```python
def test_does_not_exist(self):
    """Test handling of non-existent attributes."""
    with pytest.raises(
        AttributeError,
        match="module structlog has no attribute __yolo__"
    ):
        structlog.__yolo__
```

## Test Fixtures

The module uses standard pytest fixtures:

```python
@pytest.fixture
def recwarn():
    """
    Built-in pytest fixture for recording warnings.
    """
    return pytest.recwarn()
```

## Error Handling and Edge Cases

The module tests several error conditions:

1. Deprecation warnings for legacy attributes
2. AttributeError for non-existent attributes
3. Warning absence for supported attributes

## Testing Best Practices

1. Use Context Managers
```python
# For deprecation warnings
with pytest.deprecated_call():
    # test code

# For exceptions
with pytest.raises(AttributeError):
    # test code
```

2. Warning Verification
```python
def test_warning_check(recwarn):
    # Access deprecated attribute
    _ = structlog.__description__

    # Verify warning
    assert len(recwarn) == 1
    warning = recwarn.pop()
    assert issubclass(warning.category, DeprecationWarning)
```

3. Proper Assertion Messages
```python
def test_with_message():
    with pytest.raises(
        AttributeError,
        match=r"module structlog has no attribute.*"
    ):
        structlog.__invalid_attribute__
```

## Debugging and Troubleshooting

Common issues and solutions:

1. Warning Recording Issues
```python
# Make sure to use the recwarn fixture
def test_warnings(recwarn):
    # Your test code
    assert len(recwarn) == expected_warning_count
```

2. Deprecation Warning Capture
```python
# Ensure warnings are not filtered
import warnings
warnings.filterwarnings("always", category=DeprecationWarning)
```

## Integration Testing

Example of full integration test:

```python
class TestFullMetadataIntegration:
    def test_all_metadata_attributes(self, recwarn):
        """Test all metadata attributes in one go."""
        # Test current version (no warning)
        assert structlog.__version__
        assert len(recwarn) == 0

        # Test deprecated attributes
        with pytest.deprecated_call():
            assert structlog.__description__
        with pytest.deprecated_call():
            assert structlog.__uri__
        with pytest.deprecated_call():
            assert structlog.__email__

        # Test invalid attribute
        with pytest.raises(AttributeError):
            structlog.__invalid__
```

## Type Hints

Adding type hints to the tests:

```python
from typing import Any
from _pytest.warning_types import WarningsRecorder

class TestLegacyMetadataHack:
    def test_version(self, recwarn: WarningsRecorder) -> None:
        assert metadata.version("structlog") == structlog.__version__
        assert [] == recwarn.list

    def test_description(self) -> None:
        with pytest.deprecated_call():
            assert "Structured Logging for Python" == structlog.__description__
```

This documentation provides a comprehensive guide to understanding, using, and testing the legacy metadata functionality in structlog.
