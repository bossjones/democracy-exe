
> [!NOTE]
> Documentation auto-generated by [ai-docs.](https://github.com/connor-john/ai-docs)

Here's comprehensive documentation and testing examples for the given module:

# Module Overview

The module provides helpers for console output formatting in structlog, primarily through the `ConsoleRenderer` class. It offers:

- Colorized console output with configurable styles
- Customizable column-based log formatting
- Exception/traceback formatting with multiple backends (plain, Rich, better-exceptions)
- Windows color support via Colorama
- Flexible key-value pair rendering

Key dependencies:
- Optional: colorama (for Windows color support)
- Optional: rich (for enhanced traceback formatting)
- Optional: better-exceptions (alternative traceback formatting)

# Installation and Setup

```bash
# Core installation
pip install structlog

# Optional dependencies
pip install colorama  # For Windows color support
pip install rich     # For enhanced tracebacks
pip install better-exceptions  # For alternative tracebacks
```

# Usage Guide

Basic usage:

```python
import structlog

# Basic console renderer
console_renderer = ConsoleRenderer()

# Configure structlog
structlog.configure(
    processors=[
        structlog.processors.TimeStamper(fmt="iso"),
        structlog.stdlib.add_log_level,
        console_renderer,
    ],
)

logger = structlog.get_logger()
logger.info("Hello world", extra_field="value")
```

Customizing columns:

```python
from structlog.dev import ConsoleRenderer, Column, KeyValueColumnFormatter

# Create custom column configuration
renderer = ConsoleRenderer(
    columns=[
        Column("timestamp",
               KeyValueColumnFormatter(
                   key_style=None,
                   value_style="\033[2m",  # dim
                   reset_style="\033[0m",
                   value_repr=str
               )),
        Column("",
               KeyValueColumnFormatter(
                   key_style="\033[36m",  # cyan
                   value_style="\033[35m",  # magenta
                   reset_style="\033[0m",
                   value_repr=str
               ))
    ]
)
```

# Testing Guide

## Test Fixtures

```python
# test_console_renderer.py
from __future__ import annotations

import pytest
from io import StringIO
from structlog.dev import ConsoleRenderer, Column
from typing import Generator

@pytest.fixture
def string_io() -> Generator[StringIO, None, None]:
    """Provide StringIO for capturing output."""
    sio = StringIO()
    yield sio
    sio.close()

@pytest.fixture
def event_dict() -> dict:
    """Provide sample event dictionary."""
    return {
        "event": "test event",
        "level": "info",
        "timestamp": "2024-01-01T00:00:00Z",
        "logger": "test_logger",
        "extra": "value"
    }

@pytest.fixture
def console_renderer() -> ConsoleRenderer:
    """Provide ConsoleRenderer instance."""
    return ConsoleRenderer(colors=False)
```

## Basic Rendering Tests

```python
def test_basic_rendering(
    console_renderer: ConsoleRenderer,
    event_dict: dict,
    string_io: StringIO
) -> None:
    """Test basic event rendering."""
    result = console_renderer(None, "info", event_dict)

    assert "test event" in result
    assert "info" in result
    assert "test_logger" in result
    assert "extra=value" in result

def test_level_formatting(
    console_renderer: ConsoleRenderer,
    event_dict: dict
) -> None:
    """Test log level formatting."""
    for level in ["debug", "info", "warning", "error", "critical"]:
        event_dict["level"] = level
        result = console_renderer(None, level, event_dict)
        assert f"[{level}]" in result

@pytest.mark.parametrize("exc_info", [
    (ValueError, "test error", None),
    (KeyError, "missing key", None),
])
def test_exception_formatting(
    console_renderer: ConsoleRenderer,
    event_dict: dict,
    exc_info: tuple
) -> None:
    """Test exception formatting."""
    try:
        raise exc_info[0](exc_info[1])
    except Exception:
        event_dict["exc_info"] = True
        result = console_renderer(None, "error", event_dict)

        assert exc_info[0].__name__ in result
        assert exc_info[1] in result
```

## Column Configuration Tests

```python
def test_custom_columns(string_io: StringIO) -> None:
    """Test custom column configuration."""
    renderer = ConsoleRenderer(
        columns=[
            Column("level",
                  KeyValueColumnFormatter(
                      key_style=None,
                      value_style="",
                      reset_style="",
                      value_repr=str,
                      prefix="[",
                      postfix="]"
                  )),
            Column("",
                  KeyValueColumnFormatter(
                      key_style="",
                      value_style="",
                      reset_style="",
                      value_repr=str
                  ))
        ]
    )

    event_dict = {"level": "info", "message": "test"}
    result = renderer(None, "info", event_dict)

    assert "[info]" in result
    assert "message=test" in result

@pytest.mark.asyncio
async def test_async_logging(
    console_renderer: ConsoleRenderer,
    event_dict: dict
) -> None:
    """Test async logging scenarios."""
    async def async_operation() -> None:
        result = console_renderer(None, "info", event_dict)
        assert "test event" in result

    await async_operation()
```

## Error Handling Tests

```python
def test_invalid_column_config() -> None:
    """Test error handling for invalid column configuration."""
    with pytest.raises(ValueError):
        ConsoleRenderer(columns=[])  # Missing default formatter

def test_missing_required_keys(
    console_renderer: ConsoleRenderer
) -> None:
    """Test handling of missing required keys."""
    event_dict = {"message": "test"}  # Missing standard keys
    result = console_renderer(None, "info", event_dict)
    assert "message=test" in result

@pytest.mark.skipif(
    sys.platform != "win32",
    reason="Windows-specific color handling test"
)
def test_windows_color_handling() -> None:
    """Test Windows-specific color handling."""
    with pytest.raises(SystemError):
        ConsoleRenderer(colors=True, force_colors=True)
```

## Performance Testing

```python
def test_renderer_performance(
    console_renderer: ConsoleRenderer,
    event_dict: dict,
    benchmark
) -> None:
    """Benchmark rendering performance."""
    benchmark(console_renderer, None, "info", event_dict)
```

Testing best practices:
- Use type hints consistently
- Test both success and error paths
- Include async testing scenarios
- Test platform-specific behavior
- Include performance benchmarks
- Use parametrized tests for multiple scenarios
- Test all formatting options
- Verify output correctness
- Test exception handling
- Include integration tests with actual logging

Remember to run tests with coverage tracking:
```bash
pytest --cov=structlog.dev tests/ --cov-report=term-missing
```
