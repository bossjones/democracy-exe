
> [!NOTE]
> Documentation auto-generated by [ai-docs.](https://github.com/connor-john/ai-docs)

Module Overview:
The `dpytest` module is a testing framework specifically designed for Discord bots built with the `discord.py` library. It provides a set of tools and utilities to simplify the process of writing and running tests for Discord bot functionality. The module allows developers to create test cases that simulate interactions with the bot, verify expected behaviors, and ensure the correctness of the bot's responses.

Key features of the `dpytest` module include:
- Easy-to-use test runner for executing test cases
- Utilities for comparing and verifying Discord embeds and activities
- Peek-able queue implementation for testing asynchronous behavior
- Verification tools for asserting expected bot responses and interactions

Installation and Setup:
To install the `dpytest` module, you can use `pip`, the Python package installer. Run the following command:

```
pip install dpytest
```

The module requires Python 3.6 or higher and the `discord.py` library. Make sure you have `discord.py` installed before using `dpytest`.

Usage Guide:
Here are some examples of how to use the `dpytest` module:

1. Creating a test case:
```python
import discord
import dpytest

@dpytest.test()
async def test_ping_command(bot):
    await dpytest.message("!ping")
    assert dpytest.verify().message().content("Pong!")
```

In this example, we define a test case using the `@dpytest.test()` decorator. The test case sends a "!ping" message to the bot and verifies that the bot responds with "Pong!".

2. Comparing embeds:
```python
import discord
import dpytest

@dpytest.test()
async def test_embed_response(bot):
    await dpytest.message("!embed")
    expected_embed = discord.Embed(title="Sample Embed", description="This is a test embed.")
    assert dpytest.verify().message().embed(expected_embed)
```

This test case sends an "!embed" message to the bot and verifies that the bot responds with an embed matching the `expected_embed`.

3. Verifying activities:
```python
import discord
import dpytest

@dpytest.test()
async def test_activity_update(bot):
    expected_activity = discord.Game("Playing a game")
    await bot.change_presence(activity=expected_activity)
    assert dpytest.verify().activity(expected_activity)
```

In this example, the test case changes the bot's activity and verifies that the updated activity matches the `expected_activity`.

Testing Guide:
Here's an example test case using the `dpytest` module:

```python
import discord
import dpytest

@dpytest.test()
async def test_reaction_role(bot):
    # Test setup
    guild = bot.guilds[0]
    channel = guild.text_channels[0]
    message = await channel.send("React to get a role!")
    role = await guild.create_role(name="Test Role")

    # Execute test
    await dpytest.reaction(message, "âœ…")
    await dpytest.verify().role_added(role)

    # Cleanup
    await role.delete()
    await message.delete()
```

Test purpose and description:
This test case verifies that the bot correctly assigns a role to a member when they react to a specific message with a checkmark emoji.

Required test fixtures and setup:
- A Discord guild (server) with the bot added
- A text channel in the guild where the test message will be sent
- A role that will be assigned to the member upon reaction

Test implementation:
1. Send a message in the test channel
2. Create a test role
3. Simulate a reaction to the message with the checkmark emoji
4. Verify that the test role is added to the member who reacted
5. Clean up by deleting the test role and message

Expected outcomes and assertions:
The test case asserts that the test role is successfully added to the member after reacting to the message. This is verified using the `dpytest.verify().role_added()` assertion.

Testing Best Practices:
- Use `@dpytest.test()` decorator to define test cases
- Utilize `dpytest.message()`, `dpytest.reaction()`, and other utility functions to simulate user interactions
- Make use of `dpytest.verify()` to assert expected bot responses and behaviors
- Apply proper test setup and cleanup to ensure test isolation
- Follow the arrange-act-assert pattern for structuring test cases

Common Test Fixtures:
- `bot`: Represents the Discord bot instance being tested
- `guild`: Represents a Discord guild (server) for testing
- `channel`: Represents a text channel within a guild
- `message`: Represents a message sent in a channel

Debugging and Troubleshooting:
- Use the `pytest` framework to run tests and view test results
- Utilize the `--verbose` flag with `pytest` to get detailed test output
- Make use of Python's built-in `print()` statements for debugging
- Use the `discord.py` library's logging capabilities to log bot actions and events

Remember to:
- Write clear and concise test case descriptions
- Keep test cases focused on a single functionality or behavior
- Ensure proper test isolation by setting up and cleaning up test data
- Use meaningful assertion messages to clarify test failures
- Regularly run and update tests as the bot's codebase evolves

This documentation provides an overview of the `dpytest` module, its installation and usage, along with a comprehensive testing guide. It covers testing best practices, common test fixtures, debugging techniques, and important considerations when writing tests for Discord bots using the `dpytest` module.
