
> [!NOTE]
> Documentation auto-generated by [ai-docs.](https://github.com/connor-john/ai-docs)

I'll create comprehensive documentation for the `is_last_step` module.

# Is Last Step Module Documentation

## Module Overview

The `is_last_step` module provides utilities for managing and checking execution steps in a workflow or graph-based process. It exports two main classes:
- `IsLastStep`: A class to determine if the current step is the final one in a sequence
- `RemainingSteps`: A class to track and manage remaining steps in a workflow

### Core Features
- Step completion verification
- Remaining step tracking
- Workflow progression management

### Dependencies
- Python 3.7+
- langgraph core package

## Installation and Setup

```bash
pip install langgraph
```

## Usage Guide

### Basic Usage

```python
from langgraph.managed.is_last_step import IsLastStep, RemainingSteps

# Create an instance to track steps
remaining = RemainingSteps(total_steps=3)

# Check if current step is last
is_last = IsLastStep()

# Example workflow
def process_step(step_number: int, remaining: RemainingSteps) -> bool:
    remaining.decrement()
    return is_last.check(remaining)
```

### Advanced Usage

```python
# With context manager
from contextlib import contextmanager

class WorkflowManager:
    def __init__(self, total_steps: int):
        self.remaining = RemainingSteps(total_steps)
        self.is_last = IsLastStep()

    @contextmanager
    def step(self):
        try:
            yield
        finally:
            self.remaining.decrement()
```

## Testing Guide

### Basic Test Cases

```python
# test_is_last_step.py
from __future__ import annotations

import pytest
from langgraph.managed.is_last_step import IsLastStep, RemainingSteps

@pytest.fixture
def workflow_setup() -> tuple[IsLastStep, RemainingSteps]:
    """Provide basic workflow setup.

    Returns:
        tuple[IsLastStep, RemainingSteps]: Initialized checker and step counter
    """
    return IsLastStep(), RemainingSteps(total_steps=3)

def test_remaining_steps_initialization(workflow_setup: tuple[IsLastStep, RemainingSteps]) -> None:
    """Test proper initialization of RemainingSteps.

    Args:
        workflow_setup: Tuple containing IsLastStep and RemainingSteps instances
    """
    _, remaining = workflow_setup
    assert remaining.get_remaining() == 3

def test_step_decrement(workflow_setup: tuple[IsLastStep, RemainingSteps]) -> None:
    """Test step decrement functionality.

    Args:
        workflow_setup: Tuple containing IsLastStep and RemainingSteps instances
    """
    _, remaining = workflow_setup
    remaining.decrement()
    assert remaining.get_remaining() == 2

def test_is_last_step_check(workflow_setup: tuple[IsLastStep, RemainingSteps]) -> None:
    """Test last step detection.

    Args:
        workflow_setup: Tuple containing IsLastStep and RemainingSteps instances
    """
    is_last, remaining = workflow_setup

    # First step
    remaining.decrement()
    assert not is_last.check(remaining)

    # Second step
    remaining.decrement()
    assert not is_last.check(remaining)

    # Last step
    remaining.decrement()
    assert is_last.check(remaining)
```

### Error Cases

```python
def test_negative_steps_error() -> None:
    """Test error handling for negative step count."""
    with pytest.raises(ValueError):
        RemainingSteps(total_steps=-1)

def test_over_decrement_error(workflow_setup: tuple[IsLastStep, RemainingSteps]) -> None:
    """Test error handling for decrementing beyond zero.

    Args:
        workflow_setup: Tuple containing IsLastStep and RemainingSteps instances
    """
    _, remaining = workflow_setup

    # Decrement valid steps
    for _ in range(3):
        remaining.decrement()

    # Attempt to decrement beyond zero
    with pytest.raises(ValueError):
        remaining.decrement()
```

### Edge Cases

```python
def test_zero_steps_workflow() -> None:
    """Test behavior with zero total steps."""
    with pytest.raises(ValueError):
        RemainingSteps(total_steps=0)

def test_single_step_workflow() -> None:
    """Test workflow with single step."""
    is_last = IsLastStep()
    remaining = RemainingSteps(total_steps=1)

    assert is_last.check(remaining) == False
    remaining.decrement()
    assert is_last.check(remaining) == True
```

## Error Handling and Edge Cases

### Common Errors

1. Invalid Step Count
```python
# Raises ValueError
RemainingSteps(total_steps=-1)
RemainingSteps(total_steps=0)
```

2. Over-decrementing Steps
```python
# Raises ValueError
remaining = RemainingSteps(total_steps=1)
remaining.decrement()  # OK
remaining.decrement()  # Raises ValueError
```

## Debugging and Troubleshooting

### Logging Setup

```python
import logging

logging.basicConfig(level=logging.DEBUG)
logger = logging.getLogger(__name__)

class DebugRemainingSteps(RemainingSteps):
    def decrement(self) -> None:
        logger.debug(f"Decrementing steps from {self.get_remaining()}")
        super().decrement()
        logger.debug(f"Remaining steps: {self.get_remaining()}")
```

### Common Issues

1. Step Count Mismatch
```python
# Incorrect
remaining = RemainingSteps(total_steps=3)
is_last = IsLastStep()
is_last.check(remaining)  # Will not indicate last step without decrements

# Correct
remaining = RemainingSteps(total_steps=3)
is_last = IsLastStep()
remaining.decrement()
remaining.decrement()
remaining.decrement()
is_last.check(remaining)  # Now correctly indicates last step
```

2. Thread Safety Considerations
```python
import threading
from threading import Lock

class ThreadSafeRemainingSteps(RemainingSteps):
    def __init__(self, total_steps: int):
        super().__init__(total_steps)
        self._lock = Lock()

    def decrement(self) -> None:
        with self._lock:
            super().decrement()
```

This documentation provides a comprehensive overview of the `is_last_step` module, including usage examples, testing strategies, and common pitfalls to avoid. The test cases cover basic functionality, error conditions, and edge cases, ensuring robust validation of the module's behavior.
