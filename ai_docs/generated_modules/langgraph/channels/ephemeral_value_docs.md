
> [!NOTE]
> Documentation auto-generated by [ai-docs.](https://github.com/connor-john/ai-docs)

I'll create comprehensive documentation for the `EphemeralValue` channel module.

# EphemeralValue Channel Documentation

## Module Overview
The `EphemeralValue` channel is a specialized implementation of `BaseChannel` that temporarily stores a single value, maintaining only the most recent update. It's designed for scenarios where you need to access the last value processed in a workflow step.

### Key Features
- Stores only the most recent value
- Optional guard mechanism to enforce single-value updates
- Automatic cleanup after value retrieval
- Type-safe implementation using generics

### Dependencies
- `typing`
- `typing_extensions`
- `langgraph.channels.base`
- `langgraph.errors`

## Installation
```bash
pip install langgraph
```

## Usage Guide

### Basic Usage
```python
from langgraph.channels import EphemeralValue

# Create an EphemeralValue channel for strings
channel = EphemeralValue(str)

# Update with a single value
channel.update(["Hello"])

# Get the value
value = channel.get()  # Returns "Hello"

# After retrieval, the next get() will raise EmptyChannelError
```

### With Guard Disabled
```python
# Create channel with guard=False to allow multiple updates
channel = EphemeralValue(str, guard=False)

# Update with multiple values (last one is stored)
channel.update(["First", "Second", "Third"])  # Stores "Third"
```

## Testing Guide

### Test Cases

```python
from typing import Generator
import pytest
from langgraph.channels import EphemeralValue
from langgraph.errors import EmptyChannelError, InvalidUpdateError

@pytest.fixture
def string_channel() -> Generator[EphemeralValue[str], None, None]:
    """Fixture providing a string-typed EphemeralValue channel."""
    channel = EphemeralValue(str)
    yield channel

@pytest.fixture
def unguarded_channel() -> Generator[EphemeralValue[str], None, None]:
    """Fixture providing an unguarded EphemeralValue channel."""
    channel = EphemeralValue(str, guard=False)
    yield channel

def test_basic_value_storage(string_channel: EphemeralValue[str]) -> None:
    """Test basic value storage and retrieval."""
    string_channel.update(["test"])
    assert string_channel.get() == "test"

def test_empty_channel(string_channel: EphemeralValue[str]) -> None:
    """Test behavior of empty channel."""
    with pytest.raises(EmptyChannelError):
        string_channel.get()

def test_guard_mechanism(string_channel: EphemeralValue[str]) -> None:
    """Test guard mechanism for multiple updates."""
    with pytest.raises(InvalidUpdateError):
        string_channel.update(["first", "second"])

def test_unguarded_multiple_updates(unguarded_channel: EphemeralValue[str]) -> None:
    """Test multiple updates with guard disabled."""
    unguarded_channel.update(["first", "second", "third"])
    assert unguarded_channel.get() == "third"

def test_clear_on_empty_update(string_channel: EphemeralValue[str]) -> None:
    """Test clearing channel with empty update."""
    string_channel.update(["test"])
    string_channel.update([])
    with pytest.raises(EmptyChannelError):
        string_channel.get()

def test_checkpoint_restoration() -> None:
    """Test checkpoint creation and restoration."""
    original = EphemeralValue(str)
    original.update(["checkpoint_value"])

    checkpoint_value = original.get()
    new_channel = original.from_checkpoint(checkpoint_value)

    assert new_channel.get() == "checkpoint_value"

def test_type_safety() -> None:
    """Test type safety of the channel."""
    channel = EphemeralValue(int)
    channel.update([42])
    assert isinstance(channel.get(), int)

def test_equality() -> None:
    """Test channel equality comparison."""
    channel1 = EphemeralValue(str, guard=True)
    channel2 = EphemeralValue(str, guard=True)
    channel3 = EphemeralValue(str, guard=False)

    assert channel1 == channel2
    assert channel1 != channel3
```

### Test Categories

#### Core Functionality Tests
- Basic value storage and retrieval
- Empty channel behavior
- Guard mechanism validation
- Multiple update handling
- Clear operation testing

#### Type Safety Tests
- Type checking
- Generic type handling
- Invalid type rejection

#### State Management Tests
- Checkpoint creation
- State restoration
- Value persistence

#### Edge Cases
- Empty updates
- Multiple rapid updates
- Large value handling

## Common Issues and Solutions

### Issue: EmptyChannelError
```python
# Wrong
channel = EphemeralValue(str)
value = channel.get()  # Raises EmptyChannelError

# Correct
channel = EphemeralValue(str)
channel.update(["initial_value"])
value = channel.get()
```

### Issue: InvalidUpdateError
```python
# Wrong (with guard=True)
channel = EphemeralValue(str)
channel.update(["first", "second"])  # Raises InvalidUpdateError

# Correct
channel = EphemeralValue(str, guard=False)
channel.update(["first", "second"])  # Stores "second"
```

## Best Practices

1. Always specify the value type explicitly:
```python
channel: EphemeralValue[str] = EphemeralValue(str)
```

2. Use guard=True (default) unless multiple updates are needed
3. Handle EmptyChannelError appropriately
4. Clear channel when done using empty update
5. Use type hints consistently

## Performance Considerations

- Memory efficient due to storing only one value
- O(1) access and update operations
- Automatic cleanup prevents memory leaks
- No persistent storage overhead

This documentation provides a comprehensive guide to using and testing the EphemeralValue channel. The test suite covers all major functionality and edge cases, ensuring reliable operation in production environments.
